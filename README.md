# grunenthal_ai_agent: An AI Agent for Grünenthal
An AI Agent performing RAG over the FDA database of adverse events, Neo4j HealthcareAnalytics database and Grünenthal's 2023 financial report

## Project Structure:
    ├── app.py                          ← Streamlit chatbot UI
    ├── agent.py                        ← LangChain Agent setup
    ├── tools/
    │   ├── neo4j_rag .py               ← Tool: Neo4j graph Cypher query creation through free text RAG and graph query execution 
    │   ├── fda_api.py                  ← Tool: FDA Adverse Events API connection and retrieval
    │   └── financial_report_rag.py     ← Tool: Grünenthal's financial report PDF RAG-based information retrieval
    ├── data/
    │   └── financial_report.pdf        ← Financial report document
    ├── .env                            ← Config and environmental variables (not available in the repo for security reasons)
    ├── requirements.txt                ← Python library requirements
    └── test_prompts.txt                ← Several prompts used for testing the AI Agent

## Tools
The AI Agent uses three tools: one to query the FDA Adverse Events API, one that generates Cypher queries from free text user questions and executes them against the Neo4j Healthcare Analytics graph database, and another one that performs RAG-based infromation retrieval over Grünenthal's financial report PDF

### FDA API Tool:
This tool's code is similar to the code provided in the Case Study example. It basically performs a call to the FDA API for adverse events regarding a specific drug name, passed as input.

### Neo4j RAG Tool:
This tool was modified in order to dynamically create Cypher queries from free text questions. To do this, a Cypher generation PromptTemplate was created to provide the Gemini LLM with detailed information about the graph database schema and specific constraints for the queries (e.g., the drug names are stored in upper case). The tool then executes the generated Cypher query against the graph database and creates a humanized response from the results.

### Grünenthal's Financial Report RAG Tool:
As in the case of the Neo4j RAG Tool, this tool was also modified. In this case, the PDF document was vectorized and embeddings were created to be easier for Gemini LLM to create humanized answers from the document. The vectors and embeddings are stored in a FAISS VectorStore instance that is then used as retriever. The final result is a RAG-based humanized response created by Gemini.

## Grünenthal AI Agent/Chatbot
### The Agent (agent.py)
The Ai Agent uses the Gemini 2.0 Flash model as its main model, and is provided with the tools already described. The initial configuration/system prompt is the following:

> You are a helpful AI assistant that can answer questions about Grünenthal's financial report, the Neo4j Healthcare Analytics graph database, and FDA adverse events related to drugs. 
> You can use the following tools to answer questions:  {tools}
> Nevertheless, you can also use your own knowledge if you cannot get enough information from the tools.
> 
> Example query: Compare Grünenthal’s performance to industry benchmarks, if available.
> 
> In this case, you can use the financial report tool to answer questions about Grünenthal's financial performance, and your own knowledge to compare it to industry benchmarks.

The AI Agent appends the above configuration to the user's query, and continues appending the messages coming from its invokation and tools invokations, until it gets the final answer to show the user. 

### Streamlit UI (app.py)
This is a Streamlit application that serves as a user interface for the Grünenthal AI Agent/Chatbot.
It allows users to ask questions about the Neo4j Healthcare Analytics graph database, FDA adverse events API, or Grünenthal's financial data according to the 2023 report.
It uses the execute_agent function to process user queries and display the responses from the AI agent.
It maintains a session state to keep track of the conversation history, allowing users to see their previous questions and the AI's responses.

### Running it locally or accessing it remotely (for limited time only)
To run it locally:
 - Clone the repo
 - create a .env file with the following parameters:
 > GOOGLE_API_KEY={Google Cloud API key}
 > NEO4J_URI=bolt://{host}:7687
 > NEO4J_USER=neo4j
 > NEO4J_PASSWORD={password}
 - Install dependencies by running 'pip install -r requirements.txt' in a terminal or CLI
 - Run 'streamlit run app.py'

You can also access the Chatbot online in 

### Limitations and considerations
There are some limitations and opther things to consider when using Grünenthal AI Chatbot:
 - The Neo4j RAG Tool sometimes fails to create a runnable Cypher query. This is mainly due to the fact that queries are dynamically generated by Gemini. Further fine-tuning via prompt engineering, for instance, could yield better results.
 - The Agent more than often chooses the right tool for the task at hand, but it helps to provide some context in the query/question to guide it to the right tool. This is especially significant when selecting between the FDA APi and the Healthcare Analytics graph database, since the database provides a shorter sample dataset extracted from the original FDA database. Therefore, it is advisable to add the context in the query (e.g., "according to the FDA" or "according to the Neo4j graph database").
 - Although some error/exception handling procedures were added (e.g., try/catch clauses, handle cases in which there are no responses from the tools, etc.), it is expected for the application to crash in some circumstances. If it does crash, please reach back to me, so that I can redeploy the Chatbot. It is advisable to use the test prompts, but you can test some new ones that you think will work, although I would suggest to not go too crazy on it :P
 - Although the Agent has the ability to use its own knowledge to enhance tool responses with further information (as per the initial configuration prompt provided), it often does not. This should be investigated further in the future.
 - The Neo4j sandbox database connection will expire in some days' time. If necessary, please reach out to me, so that I can prepare a new database for testing.
 - I'm using Google Gemini, which has a free tier and offers some credit for further paid calls, but please do not treat the Grünenthal AI Chatbot as your personal ChatGPT :P ... Just kidding, have a go on it!

